<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPI Dashboard - Task Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Calculator = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="4" y="2" width="16" height="20" rx="2"/>
                <line x1="8" y1="6" x2="16" y2="6"/>
                <line x1="16" y1="14" x2="16" y2="14.01"/>
                <line x1="12" y1="14" x2="12" y2="14.01"/>
                <line x1="8" y1="14" x2="8" y2="14.01"/>
                <line x1="16" y1="18" x2="16" y2="18.01"/>
                <line x1="12" y1="18" x2="12" y2="18.01"/>
                <line x1="8" y1="18" x2="8" y2="18.01"/>
            </svg>
        );

        const Filter = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
            </svg>
        );

        const Calendar = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
        );

        const User = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
        );

        const RefreshCw = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 4 23 10 17 10"/>
                <polyline points="1 20 1 14 7 14"/>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
            </svg>
        );

        const AlertCircle = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mx-auto">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
        );

        const PerformanceChart = ({ chartData, periodLabel }) => {
            if (!chartData || chartData.length === 0) return null;
            
            const maxValue = Math.max(...chartData.map(d => d.value));
            
            return (
                <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl shadow-2xl p-8 mb-6 border border-slate-700/50">
                    <h3 className="text-2xl font-bold text-white mb-6">Performance Over Time ({periodLabel})</h3>
                    <div className="space-y-3">
                        {chartData.map((item, index) => (
                            <div key={index} className="flex items-center gap-4">
                                <div className="w-24 text-sm text-slate-300 font-medium">{item.label}</div>
                                <div className="flex-1 bg-slate-700/50 rounded-full h-8 relative overflow-hidden">
                                    <div 
                                        className="h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-500 flex items-center justify-end pr-3"
                                        style={{ width: `${(item.value / maxValue) * 100}%` }}
                                    >
                                        <span className="text-white text-xs font-bold">{item.value}%</span>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const PerformanceTracker = () => {
            const [data, setData] = useState([]);
            const [insPmtData, setInsPmtData] = useState([]);
            const [productionData, setProductionData] = useState([]);
            const [appointmentData, setAppointmentData] = useState([]);
            const [selectedName, setSelectedName] = useState('');
            const [startDate, setStartDate] = useState('');
            const [endDate, setEndDate] = useState('');
            const [uniqueNames, setUniqueNames] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [lastUpdated, setLastUpdated] = useState(null);
            const [showUnlistedTasks, setShowUnlistedTasks] = useState(false);

            const departments = {
                'AR Department': ['AD', 'AB','BDZ', 'BZ', 'GA', 'GG', 'HGB', 'IS', 'JA', 'JM', 'JS', 'KPM', 'LG', 'MB', 'MGS', 'NB', 'PT', 'RM', 'SPA', 'MCB', 'MA', 'VR', 'RD', 'LSA'],
                'Outbound Department': ['AMD', 'BM', 'CB', 'CC', 'CDC', 'DMA', 'ED', 'EMP', 'GC', 'GD', 'GP', 'HMA', 'IM', 'ISC', 'JC', 'JI', 'JL', 'JP', 'JRC', 'LL', 'LV', 'NZ', 'PB', 'RG', 'SMS', 'VL', 'WM'],
                'Verification Department': ['CF', 'GZ', 'JCB', 'JTL', 'KR', 'MLC', 'RS']
            };

            const allAllowedNames = [
                ...departments['AR Department'],
                ...departments['Outbound Department'],
                ...departments['Verification Department']
            ];

            const employeeNameMapping = {
                'ADIVINAGRACIA': 'AD', 'ADIVINA': 'AD', '**AD': 'AD',
                'ABARIOGA': 'AB', '**AB': 'AB',
                'BZARATE': 'BZ', '**BZ': 'BZ',
                'GAGBUYA': 'GA', '**GA': 'GA',
                'ISECONG': 'IS', '**IS': 'IS',
                'HBAGAPORO': 'HGB', '**HGB': 'HGB',
                'JARREY': 'JA', '**JA': 'JA',
                'RDELAPAZ': 'RD', '**RD': 'RD',
                'KMAPAIT': 'KPM', '**KPM': 'KPM',
                'GGUJILDE': 'GG', '**GG': 'GG',
                'JMORTIZ': 'JM', '**JM': 'JM',
                'LGUARNES': 'LG', '**LG': 'LG',
                'LSALAGANTIN': 'LSA', '**LSA': 'LSA',
                'JSIMYUNN': 'JS', '**JS': 'JS',
                'MAUGUSTO': 'MA', '**MA': 'MA',
                'MBONGO': 'MB', '**MB': 'MB',
                'MBACLAYON': 'MCB', '**MCB': 'MCB',
                'MSAQUIAN': 'MGS', '**MGS': 'MGS',
                'NBOLIVAR': 'NB', '**NB': 'NB',
                'PTIPAN': 'PT', '**PT': 'PT',
                'JMERCADO': 'RM', '**RM': 'RM',
                'VRUZOL': 'VR', '**VR': 'VR',
                'SADVINCULA': 'SPA', '**SPA': 'SPA',
                'CLIGASAN': 'JL', 'GCOLINARES': 'GC',
                'CBONOSTRO': 'CB', 'DAULIDA': 'DMA',
                'EMPANGILINAN': 'EMP', 'JCUNANAN': 'JC',
                'BMANALO': 'BM', 'PBENITEZ': 'PB',
                'nzambrano': 'NZ', 'vlagan': 'VL',
                'istacruz': 'ISC', 'llagan': 'LL',
                'edoronio': 'ED', 'lvillares': 'LV',
                'ssalvejo': 'SMS', 'ccapispisan': 'CDC',
                'jcadavez': 'JRC', 'adaumar': 'AMD',
                'halfonso': 'HMA', 'jogario': 'JP',
                'imorgado': 'IM', 'gpayoran': 'GP',
                'wmejares': 'WM', 'rguaves': 'RG',
                'ccapoy': 'CC', 'jincenzo': 'JI',
                'gdelacruz': 'GD'
            };

            const normalizeEmployeeName = (rawName) => {
                if (!rawName) return null;
                let name = rawName.trim().replace(/^["']|["']$/g, '');
                if (name.includes(' - ')) {
                    name = name.split(' - ')[0].trim();
                }
                if (allAllowedNames.includes(name)) {
                    return name;
                }
                const upperName = name.toUpperCase();
                const lowerName = name.toLowerCase();
                if (employeeNameMapping[upperName]) {
                    return employeeNameMapping[upperName];
                }
                if (employeeNameMapping[lowerName]) {
                    return employeeNameMapping[lowerName];
                }
                return name;
            };

            const getDepartment = (name) => {
                for (const [dept, names] of Object.entries(departments)) {
                    if (names.includes(name)) {
                        return dept;
                    }
                }
                return 'Unknown';
            };

            const employeeStateAssignments = {
                'AD': 'Alaska', 'AB': 'Alaska', 'BDZ': 'Washington', 'BZ': 'California', 
                'GA': 'Washington', 'GG': 'Washington', 'HGB': 'Washington', 'IS': 'Washington', 
                'JA': 'Washington', 'JM': 'Alaska', 'JS': 'California', 'KPM': 'Washington', 
                'LG': 'Alaska', 'MB': 'Washington', 'MGS': 'Washington', 'NB': 'California', 
                'PT': 'Alaska', 'RM': 'Alaska', 'SPA': 'Washington', 'MCB': 'Washington', 
                'MA': 'Washington', 'VR': 'Alaska', 'RD': 'Washington', 'LSA': 'Washington',
                'AMD': 'Washington', 'BM': 'Alaska', 'CB': 'Alaska', 'CC': 'Washington', 
                'CDC': 'Washington', 'DMA': 'Alaska', 'ED': 'Washington', 'EMP': 'Alaska', 
                'GC': 'Alaska', 'GD': 'Washington', 'GP': 'Washington', 'HMA': 'Washington', 
                'IM': 'Washington', 'ISC': 'Washington', 'JC': 'Alaska', 'JI': 'Washington', 
                'JL': 'Alaska', 'JP': 'Washington', 'JRC': 'Washington', 'LL': 'Washington', 
                'LV': 'Washington', 'NZ': 'Alaska', 'PB': 'Alaska', 'RG': 'Washington', 
                'SMS': 'Washington', 'VL': 'Washington', 'WM': 'Washington',
                'CF': 'Alaska', 'GZ': 'Alaska', 'JCB': 'Washington', 'JTL': 'Washington', 
                'KR': 'Washington', 'MLC': 'Alaska', 'RS': 'Washington'
            };

            const stateGoals = {
                'Alaska': { collection: 10389, production: 12269, verification: 50 },
                'Washington': { collection: 11553, production: 11039, verification: 50 },
                'California': { collection: 4545, production: 95000, verification: 50 }
            };

            const getEmployeeState = (name) => {
                return employeeStateAssignments[name] || 'Unknown';
            };

            const getEmployeeGoal = (name, type) => {
                const state = getEmployeeState(name);
                const dept = getDepartment(name);
                if (state === 'Unknown' || !stateGoals[state]) return 0;
                if (type === 'collection' && dept === 'AR Department') {
                    return stateGoals[state].collection;
                } else if (type === 'production' && dept === 'Outbound Department') {
                    return stateGoals[state].production;
                } else if (type === 'verification' && dept === 'Verification Department') {
                    return stateGoals[state].verification;
                }
                return 0;
            };

            const SHEET_ID = '1asg-4czF_ITFPxvBpyRcjMLjhjl6XGRk0_FLsrQ4D6g';
            const SHEET_ID_2 = '1U0DAPmqFTSI343bls0sj732JsRb7a6E_QLwNLSqAklw';
            const SHEET_ID_3 = '1kPorRymNrDSzUXkCwliBWOllBvAILQDWtvrtdyZBTuo';
            const API_KEY = 'AIzaSyAeiFMlkhhDjEahdKksbS6HomSCbO9iQ50';
            const SHEET_NAME = 'Data';
            const SHEET_NAME_INS_PMT = 'Ins Pmt';
            const RANGE = 'A:I';
            const RANGE_INS_PMT = 'A:G';
            const RANGE_COLLECTION = 'A:F';
            const RANGE_PRODUCTION = 'A:C';
            const RANGE_APPOINTMENTS = 'A:D';

            const COLLECTION_SHEETS = [
                'CA-CH', 'CA-WC', 'CA-QH', 'CA-TS', 'CA-SPD',
                'WA-AR', 'WA-LW', 'WA-AL', 'WA-SS', 'WA-BD',
                'WA-BR', 'WA-NP', 'WA-FW', 'WA-WD', 'WA-FD',
                'WA-SM', 'WA-BL', 'WA-SP', 'WA-SH', 'WA-PY', 'WA-FF',
                'WA-TM', 'WA-UP', 'WA-DP', 'WA-AD', 'WA-WO-FD', 'WA-WO-BD',
                'AK'
            ];

            const tasksList = [
                'Aging- Closed Denied Claims', 'Aging- Closed Paid Claims', 'Aging- Resubmit Claims',
                'Aging- Review Claims', 'Aging- Voided Claims', 'Allocation Correction Log',
                'Appointment Chart Update', 'Bank Tracker', 'Batching Claims', 'Batching Statement',
                'Billing- Inbound Call', 'Billing- Outbound Call', 'Call Listening',
                'Claims Attachments', 'Claims Not Sent', 'Compliance', 'Credentialing',
                'Daily KPI Reports', 'Doctor Payroll', 'Entering EOBs', 'Entering Kleer Payments',
                'Entering Payments', 'FA Set-up', 'Fax Data Cleaning', "Finalizing Pt's Ledger",
                'Gateway Closing- CC', 'Importing Fee Schedule to OD', 'Itemized Receipt',
                'Kleer Set-up', 'Korean Scheduled List', 'Korean Translation', 'Ledger Allocation',
                'Medicaid Report', 'Outstanding Claims Report', 'Processing CC Payments',
                'Procedure Not Billed (Sent/Batched)', 'Procedure not Billed Report',
                'Receiving Pre-Determination (PA)', 'Receiving Service Authorization (SA)',
                'Reconciliation', 'Records Release', 'Rejected Claims Resubmission',
                'Retrieving EOBs/eChecks', 'Retrieving Fee Schedule', 'Sending Appeal/MJ',
                'Sending Medicaid Claims', 'Sending Private Claims', 'Sending Pre-Determination (PA)',
                'Sending Service Authorization (SA)', 'Sending Statements', 'Sending to Collection Agency',
                'Sorting of Korean Accounts', 'Submitting Denied/Refund Letters',
                'Void/Adjustment Request', 'WA Marketing Report', '20MIN Confirmation Call',
                '24HR Confirmation Call', '48HR Confirmation Call', 'GA', 'Inbound Appt',
                'Inbound Call', 'Inbound Text Appt', 'Inbound Text', 'Labslip', 'Outbound Appt',
                'Outbound Call', 'Outbound Text Appt', 'Outbound Text', 'Patient Paperworks',
                'Travel PA', 'Treatment Call', 'Scheduling VA Patients', 'Checking VA Portal Status',
                'Processing ADA & RFS Forms', 'Calling VA Facilities/Patients',
                'Submitting ADA/RFS/XRAYS/Implant Form', 'Handling VA-related Tasks',
                'Verification (M)', 'Verification (P)', 'Verification Tracker Update',
                'Email/Teams Checked', 'Meeting', 'Miscellaneous Tasks', 'Training',
                'VM Set up', 'Gathering Dental Info', 'Gathering Insurance Info', 'Verification',
                'Clinic Closing Report', 'Kakao Lab Monitoring', 'Coding'
            ];

            const taskMapping = {
                'aging- closed denied claims': 'Outstanding Claims',
                'aging- closed paid claims': 'Outstanding Claims',
                'aging- resubmit claims': 'Outstanding Claims',
                'aging- review claims': 'Outstanding Claims',
                'aging- voided claims': 'Outstanding Claims',
                'billing- inbound call': 'Billing Call',
                'billing- outbound call': 'Billing Call',
                'receiving pre-determination (pa)': 'Receiving PA/SA',
                'receiving service authorization (sa)': 'Receiving PA/SA',
                'sending medicaid claims': 'Sending Claims',
                'sending private claims': 'Sending Claims',
                'verification (m)': 'Verification',
                'verification (p)': 'Verification'
            };

            const taskLookup = {};
            tasksList.forEach(taskName => {
                taskLookup[taskName.toLowerCase().trim()] = taskName;
            });
            Object.entries(taskMapping).forEach(([original, standard]) => {
                taskLookup[original] = standard;
            });

            const fetchDataFromSheet = async () => {
                setLoading(true);
                setError('');
                try {
                    const url1 = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}!${RANGE}?key=${API_KEY}`;
                    const response1 = await fetch(url1);
                    if (!response1.ok) throw new Error(`Failed to fetch Data sheet: ${response1.statusText}`);
                    const result1 = await response1.json();
                    const rows1 = result1.values || [];

                    const url2 = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME_INS_PMT}!${RANGE_INS_PMT}?key=${API_KEY}`;
                    const response2 = await fetch(url2);
                    if (!response2.ok) throw new Error(`Failed to fetch Ins Pmt sheet: ${response2.statusText}`);
                    const result2 = await response2.json();
                    const rows2 = result2.values || [];

                    const collectionDataPromises = COLLECTION_SHEETS.map(async (sheetName) => {
                        try {
                            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID_2}/values/${sheetName}!${RANGE_COLLECTION}?key=${API_KEY}`;
                            const response = await fetch(url);
                            if (response.ok) {
                                const result = await response.json();
                                return { sheetName, rows: result.values || [] };
                            }
                            return { sheetName, rows: [] };
                        } catch (err) {
                            return { sheetName, rows: [] };
                        }
                    });
                    const collectionResults = await Promise.all(collectionDataPromises);

                    const productionDataPromises = COLLECTION_SHEETS.map(async (sheetName) => {
                        try {
                            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID_3}/values/${sheetName}!${RANGE_PRODUCTION}?key=${API_KEY}`;
                            const response = await fetch(url);
                            if (response.ok) {
                                const result = await response.json();
                                return { sheetName, rows: result.values || [] };
                            }
                            return { sheetName, rows: [] };
                        } catch (err) {
                            return { sheetName, rows: [] };
                        }
                    });
                    const productionResults = await Promise.all(productionDataPromises);

                    const appointmentDataPromises = COLLECTION_SHEETS.map(async (sheetName) => {
                        try {
                            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID_3}/values/${sheetName}!${RANGE_APPOINTMENTS}?key=${API_KEY}`;
                            const response = await fetch(url);
                            if (response.ok) {
                                const result = await response.json();
                                return { sheetName, rows: result.values || [] };
                            }
                            return { sheetName, rows: [] };
                        } catch (err) {
                            return { sheetName, rows: [] };
                        }
                    });
                    const appointmentResults = await Promise.all(appointmentDataPromises);

                    if (rows1.length === 0 && rows2.length === 0 && collectionResults.every(r => r.rows.length === 0)) {
                        throw new Error('No data found in any sheet');
                    }

                    const parsedData = rows1.slice(1)
                        .map(row => ({
                            date: row[0] || '',
                            task: row[3] || '',
                            amount: row[4] || '',
                            collectionAmount: row[5] || '',
                            name: row[8] || '',
                            office: row[2] || '',
                            source: 'Data'
                        }))
                        .filter(row => {
                            if (!row.name || !row.name.trim() || !row.task || !row.task.trim() || !row.date || !row.date.trim()) {
                                return false;
                            }
                            let cleanName = row.name.trim().replace(/^["']|["']$/g, '');
                            return allAllowedNames.includes(cleanName);
                        });

                    const parsedInsPmt = rows2.slice(1)
                        .map(row => ({
                            date: row[2] || '',
                            amount: row[4] || '',
                            name: row[6] || '',
                            source: 'InsPmt'
                        }))
                        .filter(row => {
                            if (!row.name || !row.name.trim() || !row.date || !row.date.trim() || !row.amount || !row.amount.toString().trim()) {
                                return false;
                            }
                            let cleanName = row.name.trim().replace(/^["']|["']$/g, '');
                            return allAllowedNames.includes(cleanName);
                        });

                    const parsedCollectionData = [];
                    collectionResults.forEach(({ sheetName, rows }) => {
                        if (rows.length > 1) {
                            rows.slice(1).forEach(row => {
                                if (row.length >= 6) {
                                    const rawName = row[5] || '';
                                    const cleanName = normalizeEmployeeName(rawName);
                                    const dateValue = row[4] || '';
                                    const amountValue = row[2] || '';
                                    if (cleanName && dateValue && amountValue && allAllowedNames.includes(cleanName)) {
                                        parsedCollectionData.push({
                                            date: dateValue,
                                            amount: amountValue,
                                            name: cleanName,
                                            source: `Collection-${sheetName}`
                                        });
                                    }
                                }
                            });
                        }
                    });

                    const parsedProductionData = [];
                    productionResults.forEach(({ sheetName, rows }) => {
                        if (rows.length > 1) {
                            rows.slice(1).forEach(row => {
                                if (row.length >= 3) {
                                    const rawName = row[2] || '';
                                    const cleanName = normalizeEmployeeName(rawName);
                                    const dateValue = row[0] || '';
                                    const amountValue = row[1] || '';
                                    if (cleanName && dateValue && amountValue && allAllowedNames.includes(cleanName)) {
                                        parsedProductionData.push({
                                            date: dateValue,
                                            amount: amountValue,
                                            name: cleanName,
                                            office: sheetName,
                                            source: `Production-${sheetName}`
                                        });
                                    }
                                }
                            });
                        }
                    });

                    const parsedAppointmentData = [];
                    appointmentResults.forEach(({ sheetName, rows }) => {
                        if (rows.length > 1) {
                            rows.slice(1).forEach(row => {
                                if (row.length >= 4) {
                                    const rawName = row[2] || '';
                                    const cleanName = normalizeEmployeeName(rawName);
                                    const dateValue = row[0] || '';
                                    const appointmentCount = row[3] || '';
                                    if (cleanName && dateValue && appointmentCount && allAllowedNames.includes(cleanName)) {
                                        const count = parseFloat(appointmentCount.toString().replace(/[^0-9.]/g, ''));
                                        if (!isNaN(count) && count > 0) {
                                            parsedAppointmentData.push({
                                                date: dateValue,
                                                name: cleanName,
                                                count: count,
                                                office: sheetName,
                                                source: `Appointment-${sheetName}`
                                            });
                                        }
                                    }
                                }
                            });
                        }
                    });

                    setData(parsedData);
                    const combinedInsPmt = [...parsedInsPmt, ...parsedCollectionData];
                    setInsPmtData(combinedInsPmt);
                    setProductionData(parsedProductionData);
                    setAppointmentData(parsedAppointmentData);

                    const allNames = [
                        ...parsedData.map(row => row.name.trim().replace(/^["']|["']$/g, '')),
                        ...combinedInsPmt.map(row => row.name.trim().replace(/^["']|["']$/g, '')),
                        ...parsedProductionData.map(row => row.name.trim().replace(/^["']|["']$/g, '')),
                        ...parsedAppointmentData.map(row => row.name.trim().replace(/^["']|["']$/g, ''))
                    ];
                    const names = [...new Set(allNames)].filter(n => allAllowedNames.includes(n)).sort();
                    setUniqueNames(names);
                    setLastUpdated(new Date());
                } catch (err) {
                    console.error('Error fetching data:', err);
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchDataFromSheet();
            }, []);

            const findTaskName = (taskName) => {
                const normalized = taskName.toLowerCase().trim();
                return taskLookup[normalized] || null;
            };

            const parseDate = (dateStr) => {
                if (!dateStr) return null;
                let dateOnly = dateStr;
                if (dateStr.includes(' ')) {
                    dateOnly = dateStr.split(' ')[0];
                }
                let date = new Date(dateOnly);
                if (isNaN(date.getTime())) {
                    const parts = dateOnly.split('/');
                    if (parts.length === 3) {
                        date = new Date(parts[2], parts[0] - 1, parts[1]);
                    }
                }
                if (!isNaN(date.getTime())) {
                    date.setHours(0, 0, 0, 0);
                    return date;
                }
                return null;
            };

            const shiftWeekendToWeekday = (date) => {
                if (!date) return null;
                const dayOfWeek = date.getDay();
                const newDate = new Date(date);
                if (dayOfWeek === 0) {
                    newDate.setDate(newDate.getDate() + 1);
                } else if (dayOfWeek === 6) {
                    newDate.setDate(newDate.getDate() - 1);
                }
                return newDate;
            };

            const countWorkingDays = (startDate, endDate) => {
                if (!startDate || !endDate) return 0;
                let count = 0;
                let current = new Date(startDate);
                while (current <= endDate) {
                    const dayOfWeek = current.getDay();
                    if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                        count++;
                    }
                    current.setDate(current.getDate() + 1);
                }
                return count;
            };

            const getPerformanceColor = (percentage) => {
                if (percentage >= 100) return 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                if (percentage >= 80) return 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
                if (percentage >= 60) return 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
                return 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
            };

            const calculatePerformanceByPeriod = () => {
                if (!selectedName || !startDate || !endDate) return null;
                const start = new Date(startDate);
                const end = new Date(endDate);
                const daysDiff = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
                if (daysDiff <= 7) {
                    const chartData = [];
                    let current = new Date(start);
                    while (current <= end) {
                        const dayOfWeek = current.getDay();
                        if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                            chartData.push({
                                label: current.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                                value: 85
                            });
                        }
                        current.setDate(current.getDate() + 1);
                    }
                    return { chartData, periodLabel: 'Daily' };
                }
                return null;
            };

            const calculatePerformance = () => {
                if (!selectedName) return null;

                let filtered = data.filter(row => {
                    let rowName = row.name.trim().replace(/^["']|["']$/g, '');
                    return rowName === selectedName;
                });
                
                let filteredInsPmt = insPmtData.filter(row => {
                    let rowName = row.name.trim().replace(/^["']|["']$/g, '');
                    return rowName === selectedName;
                });
                
                let numberOfDays = 1;
                if (startDate && endDate) {
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    numberOfDays = Math.max(1, countWorkingDays(start, end));
                } else if (startDate || endDate) {
                    numberOfDays = 1;
                } else {
                    const uniqueDates = new Set();
                    filtered.forEach(row => {
                        const rowDate = parseDate(row.date);
                        if (rowDate) {
                            const shiftedDate = shiftWeekendToWeekday(rowDate);
                            if (shiftedDate) {
                                uniqueDates.add(shiftedDate.toDateString());
                            }
                        }
                    });
                    filteredInsPmt.forEach(row => {
                        const rowDate = parseDate(row.date);
                        if (rowDate) {
                            const shiftedDate = shiftWeekendToWeekday(rowDate);
                            if (shiftedDate) {
                                uniqueDates.add(shiftedDate.toDateString());
                            }
                        }
                    });
                    numberOfDays = Math.max(1, uniqueDates.size);
                }
                
                if (startDate) {
                    const startDateObj = new Date(startDate);
                    startDateObj.setHours(0, 0, 0, 0);
                    filtered = filtered.filter(row => {
                        const rowDate = parseDate(row.date);
                        return rowDate && rowDate >= startDateObj;
                    });
                    filteredInsPmt = filteredInsPmt.filter(row => {
                        const rowDate = parseDate(row.date);
                        return rowDate && rowDate >= startDateObj;
                    });
                }
                
                if (endDate) {
                    const endDateObj = new Date(endDate);
                    endDateObj.setHours(23, 59, 59, 999);
                    filtered = filtered.filter(row => {
                        const rowDate = parseDate(row.date);
                        return rowDate && rowDate <= endDateObj;
                    });
                    filteredInsPmt = filteredInsPmt.filter(row => {
                        const rowDate = parseDate(row.date);
                        return rowDate && rowDate <= endDateObj;
                    });
                }

                const taskCounts = {};
                const unlistedTasks = {};
                let totalCollectionAmount = 0;
                let totalProductionAmount = 0;
                let totalTasks = 0;
                let totalCompletedAppointments = 0;
                let totalAppointments = 0;
                let totalCalls = 0;
                
                const userDepartment = getDepartment(selectedName);
                const userState = getEmployeeState(selectedName);
                
                filtered.forEach(row => {
                    const taskName = row.task.trim();
                    const taskLower = taskName.toLowerCase();
                    const standardTaskName = findTaskName(taskName);
                    
                    if (row.amount && row.amount.toString().trim()) {
                        const amountValue = parseFloat(row.amount.toString().replace(/[$,\s]/g, '').trim());
                        if (!isNaN(amountValue) && amountValue > 0) {
                            if (standardTaskName) {
                                taskCounts[standardTaskName] = (taskCounts[standardTaskName] || 0) + amountValue;
                                totalTasks += amountValue;
                            } else {
                                unlistedTasks[taskName] = (unlistedTasks[taskName] || 0) + amountValue;
                                totalTasks += amountValue;
                            }
                        }
                    }
                    
                    if (userDepartment === 'Outbound Department') {
                        if (standardTaskName === 'Inbound Appt' || standardTaskName === 'Outbound Appt') {
                            const amountValue = parseFloat((row.amount || '1').toString().replace(/[$,\s]/g, '').trim());
                            if (!isNaN(amountValue) && amountValue > 0) {
                                totalAppointments += amountValue;
                            }
                        }
                        if (standardTaskName === 'Inbound Call' || standardTaskName === 'Outbound Call') {
                            const amountValue = parseFloat((row.amount || '1').toString().replace(/[$,\s]/g, '').trim());
                            if (!isNaN(amountValue) && amountValue > 0) {
                                totalCalls += amountValue;
                            }
                        }
                    }
                    
                    if (userDepartment === 'AR Department' && taskLower === 'total balance collected') {
                        if (row.collectionAmount && row.collectionAmount.toString().trim()) {
                            const cleanAmount = row.collectionAmount.toString().replace(/[$,\s]/g, '').trim();
                            const amount = parseFloat(cleanAmount);
                            if (!isNaN(amount) && amount > 0) {
                                totalCollectionAmount += amount;
                            }
                        }
                    }
                });

                if (userDepartment === 'Outbound Department') {
                    let filteredProduction = productionData.filter(row => {
                        let rowName = row.name.trim().replace(/^["']|["']$/g, '');
                        return rowName === selectedName;
                    });
                    if (startDate) {
                        const startDateObj = new Date(startDate);
                        startDateObj.setHours(0, 0, 0, 0);
                        filteredProduction = filteredProduction.filter(row => {
                            const rowDate = parseDate(row.date);
                            return rowDate && rowDate >= startDateObj;
                        });
                    }
                    if (endDate) {
                        const endDateObj = new Date(endDate);
                        endDateObj.setHours(23, 59, 59, 999);
                        filteredProduction = filteredProduction.filter(row => {
                            const rowDate = parseDate(row.date);
                            return rowDate && rowDate <= endDateObj;
                        });
                    }
                    filteredProduction.forEach(row => {
                        if (row.amount && row.amount.toString().trim()) {
                            const cleanAmount = row.amount.toString().replace(/[$,\s]/g, '').trim();
                            const amount = parseFloat(cleanAmount);
                            if (!isNaN(amount) && amount > 0) {
                                totalProductionAmount += amount;
                            }
                        }
                    });
                }

                if (userDepartment === 'Outbound Department') {
                    let filteredAppointments = appointmentData.filter(row => {
                        let rowName = row.name.trim().replace(/^["']|["']$/g, '');
                        return rowName === selectedName;
                    });
                    if (startDate) {
                        const startDateObj = new Date(startDate);
                        startDateObj.setHours(0, 0, 0, 0);
                        filteredAppointments = filteredAppointments.filter(row => {
                            const rowDate = parseDate(row.date);
                            return rowDate && rowDate >= startDateObj;
                        });
                    }
                    if (endDate) {
                        const endDateObj = new Date(endDate);
                        endDateObj.setHours(23, 59, 59, 999);
                        filteredAppointments = filteredAppointments.filter(row => {
                            const rowDate = parseDate(row.date);
                            return rowDate && rowDate <= endDateObj;
                        });
                    }
                    totalCompletedAppointments = filteredAppointments.reduce((sum, row) => sum + (row.count || 0), 0);
                }

                if (userDepartment === 'AR Department') {
                    filteredInsPmt.forEach(row => {
                        if (row.amount && row.amount.toString().trim()) {
                            const cleanAmount = row.amount.toString().replace(/[$,\s]/g, '').trim();
                            const amount = parseFloat(cleanAmount);
                            if (!isNaN(amount) && amount > 0) {
                                totalCollectionAmount += amount;
                            }
                        }
                    });
                }

                const sortedTasks = Object.entries(taskCounts).sort((a, b) => a[0].localeCompare(b[0]));
                const sortedUnlistedTasks = Object.entries(unlistedTasks).sort((a, b) => a[0].localeCompare(b[0]));
                const tasksWithoutCount = tasksList.filter(taskName => {
                    const hasCount = taskCounts[taskName] !== undefined;
                    const appearsInData = filtered.some(row => {
                        const standardTaskName = findTaskName(row.task.trim());
                        return standardTaskName === taskName;
                    });
                    return appearsInData && !hasCount;
                }).map(taskName => [taskName, 0]);

                let overallPerformance = 0;
                let taskPerformance = 0;
                let collectionPerformance = 0;

                if (userDepartment === 'Outbound Department') {
                    const appointmentGoal = 20 * numberOfDays;
                    const callGoal = 100 * numberOfDays;
                    const productionGoal = getEmployeeGoal(selectedName, 'production') * numberOfDays;
                    const appointmentPerformance = appointmentGoal > 0 ? (totalAppointments / appointmentGoal) * 100 : 0;
                    const callPerformance = callGoal > 0 ? (totalCalls / callGoal) * 100 : 0;
                    const productionPerformance = productionGoal > 0 ? (totalProductionAmount / productionGoal) * 100 : 0;
                    overallPerformance = Math.min(100, ((appointmentPerformance + callPerformance + productionPerformance) / 3));
                } else if (userDepartment === 'AR Department') {
                    const collectionGoal = getEmployeeGoal(selectedName, 'collection') * numberOfDays;
                    collectionPerformance = collectionGoal > 0 ? (totalCollectionAmount / collectionGoal) * 100 : 0;
                    overallPerformance = Math.min(100, collectionPerformance);
                } else if (userDepartment === 'Verification Department') {
                    const verificationGoal = getEmployeeGoal(selectedName, 'verification') * numberOfDays;
                    const verificationCount = taskCounts['Verification'] || 0;
                    const verificationPerformance = verificationGoal > 0 ? (verificationCount / verificationGoal) * 100 : 0;
                    overallPerformance = Math.min(100, verificationPerformance);
                }

                return {
                    taskCounts: sortedTasks,
                    unlistedTasks: tasksWithoutCount,
                    totalCollectionAmount: totalCollectionAmount.toFixed(2),
                    totalProductionAmount: totalProductionAmount.toFixed(2),
                    overallPerformance: Math.round(overallPerformance),
                    taskPerformance: Math.round(taskPerformance),
                    collectionPerformance: Math.round(collectionPerformance),
                    totalTasks: Math.round(totalTasks),
                    department: userDepartment,
                    state: userState,
                    totalAppointments: totalAppointments,
                    totalCalls: totalCalls,
                    totalCompletedAppointments: totalCompletedAppointments,
                    numberOfDays: numberOfDays,
                    appointmentGoal: userDepartment === 'Outbound Department' ? 20 * numberOfDays : null,
                    callGoal: userDepartment === 'Outbound Department' ? 100 * numberOfDays : null,
                    collectionGoal: userDepartment === 'AR Department' ? getEmployeeGoal(selectedName, 'collection') * numberOfDays : null,
                    productionGoal: userDepartment === 'Outbound Department' ? getEmployeeGoal(selectedName, 'production') * numberOfDays : null,
                    verificationCount: taskCounts['Verification'] || 0,
                    verificationGoal: userDepartment === 'Verification Department' ? getEmployeeGoal(selectedName, 'verification') * numberOfDays : null
                };
            };

            const performance = calculatePerformance();

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-gradient-to-r from-blue-600 to-purple-600 rounded-3xl shadow-2xl p-8 mb-8 border border-blue-400/30">
                            <h1 className="text-4xl font-bold text-white mb-2 flex items-center gap-3">
                                <Calculator />
                                KPI Dashboard
                            </h1>
                            <p className="text-blue-100">Track employee performance metrics and task completion</p>
                            {lastUpdated && (
                                <p className="text-blue-200 text-sm mt-2">
                                    Last updated: {lastUpdated.toLocaleString()}
                                </p>
                            )}
                        </div>

                        <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl shadow-2xl p-8 mb-6 border border-slate-700/50">
                            <div className="grid md:grid-cols-3 gap-6">
                                <div>
                                    <label className="block text-sm font-semibold text-gray-300 mb-2 flex items-center gap-2">
                                        <User />
                                        Employee Name
                                    </label>
                                    <select
                                        value={selectedName}
                                        onChange={(e) => setSelectedName(e.target.value)}
                                        className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                    >
                                        <option value="">Select an employee</option>
                                        {uniqueNames.map(name => (
                                            <option key={name} value={name}>{name}</option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-gray-300 mb-2 flex items-center gap-2">
                                        <Calendar />
                                        Start Date
                                    </label>
                                    <input
                                        type="date"
                                        value={startDate}
                                        onChange={(e) => setStartDate(e.target.value)}
                                        className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-gray-300 mb-2 flex items-center gap-2">
                                        <Calendar />
                                        End Date
                                    </label>
                                    <input
                                        type="date"
                                        value={endDate}
                                        onChange={(e) => setEndDate(e.target.value)}
                                        className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                    />
                                </div>
                            </div>

                            <button
                                onClick={fetchDataFromSheet}
                                disabled={loading}
                                className="mt-6 w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
                            >
                                <RefreshCw className={loading ? 'animate-spin' : ''} />
                                {loading ? 'Loading...' : 'Refresh Data'}
                            </button>
                        </div>

                        {error && (
                            <div className="bg-red-900/50 border-2 border-red-500 text-red-200 px-6 py-4 rounded-xl mb-6 backdrop-blur-sm">
                                <p className="font-semibold">Error: {error}</p>
                            </div>
                        )}

                        {!selectedName && (
                            <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl shadow-2xl p-12 text-center border border-slate-700/50">
                                <Filter />
                                <p className="mt-4 text-gray-300 text-lg">Please select an employee to view their performance metrics</p>
                            </div>
                        )}

                        {performance && (
                            <div className="space-y-6">
                                <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    {performance.department === 'AR Department' ? (
                                        <div className="relative overflow-hidden bg-gradient-to-br from-emerald-600 via-green-600 to-teal-600 rounded-2xl shadow-2xl p-6 border-2 border-emerald-400/50">
                                            <div className="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-16 -mt-16"></div>
                                            <div className="absolute bottom-0 left-0 w-24 h-24 bg-black/5 rounded-full -ml-12 -mb-12"></div>
                                            <div className="relative">
                                                <p className="text-emerald-100 text-sm font-medium mb-1">Total Balance Collected</p>
                                                <p className="text-white font-bold text-4xl tracking-tight">
                                                    ${parseFloat(performance.totalCollectionAmount).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                                                </p>
                                            </div>
                                        </div>
                                    ) : performance.department === 'Outbound Department' ? (
                                        <div className="relative overflow-hidden bg-gradient-to-br from-emerald-600 via-green-600 to-teal-600 rounded-2xl shadow-2xl p-6 border-2 border-emerald-400/50">
                                            <div className="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-16 -mt-16"></div>
                                            <div className="absolute bottom-0 left-0 w-24 h-24 bg-black/5 rounded-full -ml-12 -mb-12"></div>
                                            <div className="relative">
                                                <p className="text-emerald-100 text-sm font-medium mb-1">Total Completed Production</p>
                                                <p className="text-white font-bold text-4xl tracking-tight">
                                                    ${parseFloat(performance.totalProductionAmount).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                                                </p>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="relative overflow-hidden bg-gradient-to-br from-emerald-600 via-green-600 to-teal-600 rounded-2xl shadow-2xl p-6 border-2 border-emerald-400/50">
                                            <div className="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-16 -mt-16"></div>
                                            <div className="absolute bottom-0 left-0 w-24 h-24 bg-black/5 rounded-full -ml-12 -mb-12"></div>
                                            <div className="relative">
                                                <p className="text-emerald-100 text-sm font-medium mb-1">Total Verifications Completed</p>
                                                <p className="text-white font-bold text-4xl tracking-tight">
                                                    {performance.verificationCount}
                                                </p>
                                            </div>
                                        </div>
                                    )}

                                    <div className="relative overflow-hidden bg-gradient-to-br from-blue-600 via-indigo-600 to-purple-600 rounded-2xl shadow-2xl p-6 border-2 border-blue-400/50">
                                        <div className="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-16 -mt-16"></div>
                                        <div className="absolute bottom-0 left-0 w-24 h-24 bg-black/5 rounded-full -ml-12 -mb-12"></div>
                                        <div className="relative">
                                            {performance.department === 'AR Department' ? (
                                                <>
                                                    <p className="text-blue-100 text-sm font-medium mb-1">Collection Goal ({performance.numberOfDays} working {performance.numberOfDays === 1 ? 'day' : 'days'})</p>
                                                    <p className="text-white font-bold text-4xl tracking-tight">
                                                        ${performance.collectionGoal ? performance.collectionGoal.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : '0.00'}
                                                    </p>
                                                </>
                                            ) : performance.department === 'Outbound Department' ? (
                                                <>
                                                    <p className="text-blue-100 text-sm font-medium mb-1">Production Goal ({performance.numberOfDays} working {performance.numberOfDays === 1 ? 'day' : 'days'})</p>
                                                    <p className="text-white font-bold text-4xl tracking-tight">
                                                        ${performance.productionGoal ? performance.productionGoal.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : '0.00'}
                                                    </p>
                                                </>
                                            ) : performance.department === 'Verification Department' ? (
                                                <>
                                                    <p className="text-blue-100 text-sm font-medium mb-1">Verification Goal ({performance.numberOfDays} working {performance.numberOfDays === 1 ? 'day' : 'days'})</p>
                                                    <p className="text-white font-bold text-4xl tracking-tight">
                                                        {performance.verificationGoal || 0}
                                                    </p>
                                                </>
                                            ) : (
                                                <>
                                                    <p className="text-blue-100 text-sm font-medium mb-1">Department Goal</p>
                                                    <p className="text-white font-bold text-4xl tracking-tight">N/A</p>
                                                </>
                                            )}
                                        </div>
                                    </div>

                                    {performance.department === 'Outbound Department' && (
                                        <div className="relative overflow-hidden bg-gradient-to-br from-purple-600 via-pink-600 to-rose-600 rounded-2xl shadow-2xl p-6 border-2 border-purple-400/50">
                                            <div className="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-16 -mt-16"></div>
                                            <div className="absolute bottom-0 left-0 w-24 h-24 bg-black/5 rounded-full -ml-12 -mb-12"></div>
                                            <div className="relative">
                                                <p className="text-purple-100 text-sm font-medium mb-1">Completed Appointments</p>
                                                <p className="text-white font-bold text-4xl tracking-tight">
                                                    {performance.totalCompletedAppointments || 0}
                                                </p>
                                            </div>
                                        </div>
                                    )}

                                    <div 
                                        className="relative overflow-hidden rounded-2xl shadow-2xl p-6 border-2 transition-all duration-500"
                                        style={{
                                            background: getPerformanceColor(performance.overallPerformance),
                                            borderColor: `rgba(255, 255, 255, 0.3)`
                                        }}
                                    >
                                        <div className="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"></div>
                                        <div className="absolute bottom-0 left-0 w-24 h-24 bg-black/10 rounded-full -ml-12 -mb-12"></div>
                                        <div className="relative">
                                            <p className="text-white/90 text-sm font-medium mb-1">Overall Performance</p>
                                            <p className="text-white font-bold text-4xl tracking-tight">
                                                {performance.overallPerformance}%
                                            </p>
                                            <p className="text-white/80 text-xs mt-2">
                                                {Object.keys(performance.taskCounts).length} of {tasksList.length} unique tasks completed
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {(() => {
                                    const chartDataResult = calculatePerformanceByPeriod();
                                    return chartDataResult ? (
                                        <PerformanceChart 
                                            chartData={chartDataResult.chartData} 
                                            periodLabel={chartDataResult.periodLabel} 
                                        />
                                    ) : null;
                                })()}
                
                                <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl shadow-2xl p-8 border border-slate-700/50">
                                    <div className="flex items-center justify-between mb-6 pb-4 border-b border-slate-700/50">
                                        <h3 className="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent flex items-center gap-3">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="url(#blue-gradient)" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                <defs>
                                                    <linearGradient id="blue-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                                        <stop offset="0%" stopColor="#60A5FA" />
                                                        <stop offset="100%" stopColor="#A78BFA" />
                                                    </linearGradient>
                                                </defs>
                                                <path d="M9 11l3 3L22 4"/>
                                                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                                            </svg>
                                            Tasks Completed
                                        </h3>
                                        <div className="flex items-center gap-3">
                                            <span className="text-sm font-semibold text-slate-400 bg-slate-700/50 px-4 py-2 rounded-full">
                                                {performance.totalTasks} Total Count
                                            </span>
                                            {performance.unlistedTasks.length > 0 && (
                                                <button
                                                    onClick={() => setShowUnlistedTasks(!showUnlistedTasks)}
                                                    className="flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-full transition-colors text-sm font-semibold"
                                                >
                                                    <span>Other Tasks</span>
                                                    <span className="bg-blue-500 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">
                                                        {performance.unlistedTasks.length}
                                                    </span>
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                    
                                    <div className="grid md:grid-cols-3 lg:grid-cols-4 gap-3">
                                        {performance.taskCounts.map(([taskName, count]) => (
                                            <div key={taskName} className="group relative bg-gradient-to-br from-slate-700/80 to-slate-800/80 backdrop-blur-sm rounded-xl p-3 hover:from-blue-600/20 hover:to-purple-600/20 transition-all duration-300 border border-slate-600/30 hover:border-blue-500/50 hover:shadow-lg hover:shadow-blue-500/10 cursor-pointer">
                                                <div className="flex flex-col gap-2">
                                                    <span className="text-gray-200 text-sm font-medium leading-tight line-clamp-2 group-hover:text-white transition-colors">{taskName}</span>
                                                    <div className="flex items-center justify-between">
                                                        <span className="text-xs text-slate-400 group-hover:text-slate-300">Count</span>
                                                        <span className="bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold px-2.5 py-1 rounded-lg text-sm shadow-md group-hover:shadow-lg group-hover:scale-105 transition-all">{Math.round(count)}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {showUnlistedTasks && performance.unlistedTasks.length > 0 && (
                                        <div className="mt-6 pt-6 border-t border-slate-700/50">
                                            <h4 className="text-lg font-bold text-yellow-400 mb-4 flex items-center gap-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                    <circle cx="12" cy="12" r="10"/>
                                                    <line x1="12" y1="16" x2="12" y2="12"/>
                                                    <line x1="12" y1="8" x2="12.01" y2="8"/>
                                                </svg>
                                                Other Tasks (No Count in Column E)
                                            </h4>
                                            <div className="grid md:grid-cols-3 lg:grid-cols-4 gap-3">
                                                {performance.unlistedTasks.map(([taskName, count]) => (
                                                    <div key={taskName} className="group relative bg-gradient-to-br from-yellow-900/30 to-orange-900/30 backdrop-blur-sm rounded-xl p-3 hover:from-yellow-600/20 hover:to-orange-600/20 transition-all duration-300 border border-yellow-600/30 hover:border-yellow-500/50 hover:shadow-lg hover:shadow-yellow-500/10">
                                                        <div className="flex flex-col gap-2">
                                                            <span className="text-yellow-200 text-sm font-medium leading-tight line-clamp-2 group-hover:text-yellow-100 transition-colors">{taskName}</span>
                                                            <div className="flex items-center justify-between">
                                                                <span className="text-xs text-yellow-400/70 italic">No count in sheet</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    {performance.taskCounts.length === 0 && (
                                        <div className="text-center py-12 text-gray-400">
                                            <AlertCircle />
                                            <p className="mt-3 text-sm">No tasks found for the selected filters</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<PerformanceTracker />, document.getElementById('root'));
    </script>
</body>
</html>
