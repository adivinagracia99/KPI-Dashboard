<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPI Dashboard - Task Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icon Components
        const Calculator = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="4" y="2" width="16" height="20" rx="2"/>
                <line x1="8" y1="6" x2="16" y2="6"/>
                <line x1="16" y1="14" x2="16" y2="14.01"/>
                <line x1="12" y1="14" x2="12" y2="14.01"/>
                <line x1="8" y1="14" x2="8" y2="14.01"/>
                <line x1="16" y1="18" x2="16" y2="18.01"/>
                <line x1="12" y1="18" x2="12" y2="18.01"/>
                <line x1="8" y1="18" x2="8" y2="18.01"/>
            </svg>
        );

        const Calendar = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
        );

        const User = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
        );

        const RefreshCw = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 4 23 10 17 10"/>
                <polyline points="1 20 1 14 7 14"/>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
            </svg>
        );

        const DollarSign = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="1" x2="12" y2="23"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
        );

        const Clipboard = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
            </svg>
        );

        const CheckCircle = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
        );

        const Clock = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
            </svg>
        );

        const TrendingUp = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                <polyline points="17 6 23 6 23 12"/>
            </svg>
        );

        const TrendingDown = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/>
                <polyline points="17 18 23 18 23 12"/>
            </svg>
        );

        // Configuration Data
        const departments = {
            'AR Department': ['AD', 'AB','BDZ', 'BZ', 'GA', 'GG', 'HGB', 'IS', 'JA', 'JM', 'JS', 'KPM', 'LG', 'MB', 'MGS', 'NB', 'PT', 'RM', 'SPA', 'MCB', 'MA', 'VR', 'RD', 'LSA'],
            'Outbound Department': ['AMD', 'BM', 'CB', 'CC', 'CDC', 'DMA', 'ED', 'EMP', 'GC', 'GD', 'GP', 'HMA', 'IM', 'ISC', 'JC', 'JI', 'JL', 'JP', 'JRC', 'LL', 'LV', 'NZ', 'PB', 'RG', 'SMS', 'VL', 'WM'],
            'Verification Department': ['CF', 'GZ', 'JCB', 'JTL', 'KR', 'MLC', 'RS']
        };

        const allAllowedNames = [
            ...departments['AR Department'],
            ...departments['Outbound Department'],
            ...departments['Verification Department']
        ];

        const employeeNameMapping = {
            'ADIVINAGRACIA': 'AD', 'ADIVINA': 'AD', '**AD': 'AD',
            'ABARIOGA': 'AB', '**AB': 'AB',
            'BZARATE': 'BZ', '**BZ': 'BZ',
            'GAGBUYA': 'GA', 'ISECONG': 'IS', 'HBAGAPORO': 'HGB',
            'JARREY': 'JA', 'RDELAPAZ': 'RD', 'KMAPAIT': 'KPM',
            'GGUJILDE': 'GG', 'JMORTIZ': 'JM', 'LGUARNES': 'LG',
            'LSALAGANTIN': 'LSA', 'JSIMYUNN': 'JS', 'MAUGUSTO': 'MA',
            'MBONGO': 'MB', 'MBACLAYON': 'MCB', 'MSAQUIAN': 'MGS',
            'NBOLIVAR': 'NB', 'PTIPAN': 'PT', 'JMERCADO': 'RM',
            'VRUZOL': 'VR', 'SADVINCULA': 'SPA',
            '**GA': 'GA', '**IS': 'IS', '**HGB': 'HGB', '**JA': 'JA',
            '**RD': 'RD', '**KPM': 'KPM', '**GG': 'GG', '**JM': 'JM',
            '**LG': 'LG', '**LSA': 'LSA', '**JS': 'JS', '**MA': 'MA',
            '**MB': 'MB', '**MCB': 'MCB', '**MGS': 'MGS', '**NB': 'NB',
            '**PT': 'PT', '**RM': 'RM', '**VR': 'VR', '**SPA': 'SPA',
            'CLIGASAN': 'JL', 'GCOLINARES': 'GC', 'CBONOSTRO': 'CB',
            'DAULIDA': 'DMA', 'EMPANGILINAN': 'EMP', 'JCUNANAN': 'JC',
            'BMANALO': 'BM', 'PBENITEZ': 'PB', 'nzambrano': 'NZ',
            'vlagan': 'VL', 'istacruz': 'ISC', 'llagan': 'LL',
            'edoronio': 'ED', 'lvillares': 'LV', 'ssalvejo': 'SMS',
            'ccapispisan': 'CDC', 'jcadavez': 'JRC', 'adaumar': 'AMD',
            'halfonso': 'HMA', 'jogario': 'JP', 'imorgado': 'IM',
            'gpayoran': 'GP', 'wmejares': 'WM', 'rguaves': 'RG',
            'ccapoy': 'CC', 'jincenzo': 'JI', 'gdelacruz': 'GD'
        };

        const employeeStateAssignments = {
            'AD': 'Alaska', 'AB': 'Alaska', 'BDZ': 'Washington', 'BZ': 'California', 'GA': 'Washington', 
            'GG': 'Washington', 'HGB': 'Washington', 'IS': 'Washington', 'JA': 'Washington', 
            'JM': 'Alaska', 'JS': 'California', 'KPM': 'Washington', 'LG': 'Alaska', 
            'MB': 'Washington', 'MGS': 'Washington', 'NB': 'California', 'PT': 'Alaska', 
            'RM': 'Alaska', 'SPA': 'Washington', 'MCB': 'Washington', 'MA': 'Washington', 
            'VR': 'Alaska', 'RD': 'Washington', 'LSA': 'Washington',
            'AMD': 'Washington', 'BM': 'Alaska', 'CB': 'Alaska', 'CC': 'Washington', 
            'CDC': 'Washington', 'DMA': 'Alaska', 'ED': 'Washington', 'EMP': 'Alaska', 
            'GC': 'Alaska', 'GD': 'Washington', 'GP': 'Washington', 'HMA': 'Washington', 
            'IM': 'Washington', 'ISC': 'Washington', 'JC': 'Alaska', 'JI': 'Washington', 
            'JL': 'Alaska', 'JP': 'Washington', 'JRC': 'Washington', 'LL': 'Washington', 
            'LV': 'Washington', 'NZ': 'Alaska', 'PB': 'Alaska', 'RG': 'Washington', 
            'SMS': 'Washington', 'VL': 'Washington', 'WM': 'Washington',
            'CF': 'Alaska', 'GZ': 'Alaska', 'JCB': 'Washington', 'JTL': 'Washington', 
            'KR': 'Washington', 'MLC': 'Alaska', 'RS': 'Washington'
        };

        const stateGoals = {
            'Alaska': { collection: 10389, production: 12269, verification: 50 },
            'Washington': { collection: 11553, production: 11039, verification: 50 },
            'California': { collection: 4545, production: 95000, verification: 50 }
        };

        const tasksList = [
            'Aging- Closed Denied Claims', 'Aging- Closed Paid Claims', 'Aging- Resubmit Claims',
            'Aging- Review Claims', 'Aging- Voided Claims', 'Allocation Correction Log',
            'Appointment Chart Update', 'Bank Tracker', 'Batching Claims', 'Batching Statement',
            'Billing- Inbound Call', 'Billing- Outbound Call', 'Call Listening', 'Claims Attachments',
            'Claims Not Sent', 'Compliance', 'Credentialing', 'Daily KPI Reports', 'Doctor Payroll',
            'Entering EOBs', 'Entering Kleer Payments', 'Entering Payments', 'FA Set-up',
            'Fax Data Cleaning', "Finalizing Pt's Ledger", 'Gateway Closing- CC',
            'Importing Fee Schedule to OD', 'Itemized Receipt', 'Kleer Set-up',
            'Korean Scheduled List', 'Korean Translation', 'Ledger Allocation', 'Medicaid Report',
            'Outstanding Claims Report', 'Processing CC Payments', 'Procedure Not Billed (Sent/Batched)',
            'Procedure not Billed Report', 'Receiving Pre-Determination (PA)',
            'Receiving Service Authorization (SA)', 'Reconciliation', 'Records Release',
            'Rejected Claims Resubmission', 'Retrieving EOBs/eChecks', 'Retrieving Fee Schedule',
            'Sending Appeal/MJ', 'Sending Medicaid Claims', 'Sending Private Claims',
            'Sending Pre-Determination (PA)', 'Sending Service Authorization (SA)',
            'Sending Statements', 'Sending to Collection Agency', 'Sorting of Korean Accounts',
            'Submitting Denied/Refund Letters', 'Void/Adjustment Request', 'WA Marketing Report',
            '20MIN Confirmation Call', '24HR Confirmation Call', '48HR Confirmation Call',
            'GA', 'Inbound Appt', 'Inbound Call', 'Inbound Text Appt', 'Inbound Text',
            'Labslip', 'Outbound Appt', 'Outbound Call', 'Outbound Text Appt', 'Outbound Text',
            'Patient Paperworks', 'Travel PA', 'Treatment Call', 'Scheduling VA Patients',
            'Checking VA Portal Status', 'Processing ADA & RFS Forms', 'Calling VA Facilities/Patients',
            'Submitting ADA/RFS/XRAYS/Implant Form', 'Handling VA-related Tasks',
            'Verification (M)', 'Verification (P)', 'Verification Tracker Update',
            'Email/Teams Checked', 'Meeting', 'Miscellaneous Tasks', 'Training', 'VM Set up',
            'Gathering Dental Info', 'Gathering Insurance Info', 'Verification',
            'Clinic Closing Report', 'Kakao Lab Monitoring', 'Coding'
        ];

        const taskMapping = {
            'aging- closed denied claims': 'Outstanding Claims',
            'aging- closed paid claims': 'Outstanding Claims',
            'aging- resubmit claims': 'Outstanding Claims',
            'aging- review claims': 'Outstanding Claims',
            'aging- voided claims': 'Outstanding Claims',
            'billing- inbound call': 'Billing Call',
            'billing- outbound call': 'Billing Call',
            'receiving pre-determination (pa)': 'Receiving PA/SA',
            'receiving service authorization (sa)': 'Receiving PA/SA',
            'sending medicaid claims': 'Sending Claims',
            'sending private claims': 'Sending Claims',
            'verification (m)': 'Verification',
            'verification (p)': 'Verification'
        };

        const taskLookup = {};
        tasksList.forEach(taskName => {
            taskLookup[taskName.toLowerCase().trim()] = taskName;
        });
        
        Object.entries(taskMapping).forEach(([original, standard]) => {
            taskLookup[original] = standard;
        });

        const SHEET_ID = '1asg-4czF_ITFPxvBpyRcjMLjhjl6XGRk0_FLsrQ4D6g';
        const SHEET_ID_2 = '1U0DAPmqFTSI343bls0sj732JsRb7a6E_QLwNLSqAklw';
        const SHEET_ID_3 = '1kPorRymNrDSzUXkCwliBWOllBvAILQDWtvrtdyZBTuo';
        const API_KEY = 'AIzaSyAeiFMlkhhDjEahdKksbS6HomSCbO9iQ50';

        const COLLECTION_SHEETS = [
            'CA-CH', 'CA-WC', 'CA-QH', 'CA-TS', 'CA-SPD',
            'WA-AR', 'WA-LW', 'WA-AL', 'WA-SS', 'WA-BD',
            'WA-BR', 'WA-NP', 'WA-FW', 'WA-WD', 'WA-FD',
            'WA-SM', 'WA-BL', 'WA-SP', 'WA-SH', 'WA-PY', 'WA-FF',
            'WA-TM', 'WA-UP', 'WA-DP', 'WA-AD', 'WA-WO-FD', 'WA-WO-BD',
            'AK'
        ];

        // Helper Functions
        const normalizeEmployeeName = (rawName) => {
            if (!rawName) return null;
            let name = rawName.trim().replace(/^["']|["']$/g, '');
            if (name.includes(' - ')) {
                name = name.split(' - ')[0].trim();
            }
            if (allAllowedNames.includes(name)) {
                return name;
            }
            const upperName = name.toUpperCase();
            const lowerName = name.toLowerCase();
            if (employeeNameMapping[upperName]) {
                return employeeNameMapping[upperName];
            }
            if (employeeNameMapping[lowerName]) {
                return employeeNameMapping[lowerName];
            }
            return name;
        };

        const getDepartment = (name) => {
            for (const [dept, names] of Object.entries(departments)) {
                if (names.includes(name)) {
                    return dept;
                }
            }
            return 'Unknown';
        };

        const getEmployeeState = (name) => {
            return employeeStateAssignments[name] || 'Unknown';
        };

        const getEmployeeGoal = (name, type) => {
            const state = getEmployeeState(name);
            const dept = getDepartment(name);
            if (state === 'Unknown' || !stateGoals[state]) return 0;
            if (type === 'collection' && dept === 'AR Department') {
                return stateGoals[state].collection;
            } else if (type === 'production' && dept === 'Outbound Department') {
                return stateGoals[state].production;
            } else if (type === 'verification' && dept === 'Verification Department') {
                return stateGoals[state].verification;
            }
            return 0;
        };

        const findTaskName = (taskName) => {
            const normalized = taskName.toLowerCase().trim();
            return taskLookup[normalized] || null;
        };

        const parseDate = (dateStr) => {
            if (!dateStr) return null;
            let dateOnly = dateStr;
            if (dateStr.includes(' ')) {
                dateOnly = dateStr.split(' ')[0];
            }
            let date = new Date(dateOnly);
            if (isNaN(date.getTime())) {
                const parts = dateOnly.split('/');
                if (parts.length === 3) {
                    date = new Date(parts[2], parts[0] - 1, parts[1]);
                }
            }
            if (!isNaN(date.getTime())) {
                date.setHours(0, 0, 0, 0);
                return date;
            }
            return null;
        };

        const shiftWeekendToWeekday = (date) => {
            if (!date) return null;
            const dayOfWeek = date.getDay();
            const newDate = new Date(date);
            if (dayOfWeek === 0) {
                newDate.setDate(newDate.getDate() + 1);
            } else if (dayOfWeek === 6) {
                newDate.setDate(newDate.getDate() - 1);
            }
            return newDate;
        };

        const countWorkingDays = (startDate, endDate) => {
            if (!startDate || !endDate) return 0;
            let count = 0;
            let current = new Date(startDate);
            while (current <= endDate) {
                const dayOfWeek = current.getDay();
                if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                    count++;
                }
                current.setDate(current.getDate() + 1);
            }
            return count;
        };

        // Main Component
        const PerformanceTracker = () => {
            const [data, setData] = useState([]);
            const [insPmtData, setInsPmtData] = useState([]);
            const [productionData, setProductionData] = useState([]);
            const [appointmentData, setAppointmentData] = useState([]);
            const [selectedName, setSelectedName] = useState('');
            const [startDate, setStartDate] = useState('');
            const [endDate, setEndDate] = useState('');
            const [uniqueNames, setUniqueNames] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [lastUpdated, setLastUpdated] = useState(null);

            // Fetch Data Function
            const fetchDataFromSheet = async () => {
                setLoading(true);
                setError('');
                
                try {
                    // Fetch Data sheet
                    const url1 = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Data!A:I?key=${API_KEY}`;
                    const response1 = await fetch(url1);
                    if (!response1.ok) throw new Error(`Failed to fetch Data sheet: ${response1.statusText}`);
                    const result1 = await response1.json();
                    const rows1 = result1.values || [];

                    // Fetch Ins Pmt sheet
                    const url2 = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Ins Pmt!A:G?key=${API_KEY}`;
                    const response2 = await fetch(url2);
                    if (!response2.ok) throw new Error(`Failed to fetch Ins Pmt sheet: ${response2.statusText}`);
                    const result2 = await response2.json();
                    const rows2 = result2.values || [];

                    // Fetch collection sheets
                    const collectionDataPromises = COLLECTION_SHEETS.map(async (sheetName) => {
                        try {
                            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID_2}/values/${sheetName}!A:F?key=${API_KEY}`;
                            const response = await fetch(url);
                            if (response.ok) {
                                const result = await response.json();
                                return { sheetName, rows: result.values || [] };
                            }
                            return { sheetName, rows: [] };
                        } catch (err) {
                            console.warn(`Failed to fetch ${sheetName}:`, err);
                            return { sheetName, rows: [] };
                        }
                    });
                    const collectionResults = await Promise.all(collectionDataPromises);

                    // Fetch production sheets
                    const productionDataPromises = COLLECTION_SHEETS.map(async (sheetName) => {
                        try {
                            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID_3}/values/${sheetName}!A:C?key=${API_KEY}`;
                            const response = await fetch(url);
                            if (response.ok) {
                                const result = await response.json();
                                return { sheetName, rows: result.values || [] };
                            }
                            return { sheetName, rows: [] };
                        } catch (err) {
                            console.warn(`Failed to fetch production from ${sheetName}:`, err);
                            return { sheetName, rows: [] };
                        }
                    });
                    const productionResults = await Promise.all(productionDataPromises);

                    // Fetch appointment sheets
                    const appointmentDataPromises = COLLECTION_SHEETS.map(async (sheetName) => {
                        try {
                            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID_3}/values/${sheetName}!A:D?key=${API_KEY}`;
                            const response = await fetch(url);
                            if (response.ok) {
                                const result = await response.json();
                                return { sheetName, rows: result.values || [] };
                            }
                            return { sheetName, rows: [] };
                        } catch (err) {
                            console.warn(`Failed to fetch appointments from ${sheetName}:`, err);
                            return { sheetName, rows: [] };
                        }
                    });
                    const appointmentResults = await Promise.all(appointmentDataPromises);

                    // Parse Data sheet
                    const parsedData = rows1.slice(1)
                        .map(row => ({
                            date: row[0] || '',
                            task: row[3] || '',
                            amount: row[4] || '',
                            collectionAmount: row[5] || '',
                            name: row[8] || '',
                            office: row[2] || '',
                            source: 'Data'
                        }))
                        .filter(row => {
                            if (!row.name || !row.name.trim() || !row.task || !row.task.trim() || !row.date || !row.date.trim()) {
                                return false;
                            }
                            let cleanName = row.name.trim().replace(/^["']|["']$/g, '');
                            return allAllowedNames.includes(cleanName);
                        });

                    // Parse Ins Pmt sheet
                    const parsedInsPmt = rows2.slice(1)
                        .map(row => ({
                            date: row[2] || '',
                            amount: row[4] || '',
                            name: row[6] || '',
                            source: 'InsPmt'
                        }))
                        .filter(row => {
                            if (!row.name || !row.name.trim() || !row.date || !row.date.trim() || !row.amount || !row.amount.toString().trim()) {
                                return false;
                            }
                            let cleanName = row.name.trim().replace(/^["']|["']$/g, '');
                            return allAllowedNames.includes(cleanName);
                        });

                    // Parse collection data
                    const parsedCollectionData = [];
                    collectionResults.forEach(({ sheetName, rows }) => {
                        if (rows.length > 1) {
                            rows.slice(1).forEach(row => {
                                if (row.length >= 6) {
                                    const rawName = row[5] || '';
                                    const cleanName = normalizeEmployeeName(rawName);
                                    const dateValue = row[4] || '';
                                    const amountValue = row[2] || '';
                                    if (cleanName && dateValue && amountValue && allAllowedNames.includes(cleanName)) {
                                        parsedCollectionData.push({
                                            date: dateValue,
                                            amount: amountValue,
                                            name: cleanName,
                                            source: `Collection-${sheetName}`
                                        });
                                    }
                                }
                            });
                        }
                    });

                    // Parse production data
                    const parsedProductionData = [];
                    productionResults.forEach(({ sheetName, rows }) => {
                        if (rows.length > 1) {
                            rows.slice(1).forEach(row => {
                                if (row.length >= 3) {
                                    const rawName = row[2] || '';
                                    const cleanName = normalizeEmployeeName(rawName);
                                    const dateValue = row[0] || '';
                                    const amountValue = row[1] || '';
                                    if (cleanName && dateValue && amountValue && allAllowedNames.includes(cleanName)) {
                                        parsedProductionData.push({
                                            date: dateValue,
                                            amount: amountValue,
                                            name: cleanName,
                                            office: sheetName,
                                            source: `Production-${sheetName}`
                                        });
                                    }
                                }
                            });
                        }
                    });

                    // Parse appointment data
                    const parsedAppointmentData = [];
                    appointmentResults.forEach(({ sheetName, rows }) => {
                        if (rows.length > 1) {
                            rows.slice(1).forEach(row => {
                                if (row.length >= 4) {
                                    const rawName = row[2] || '';
                                    const cleanName = normalizeEmployeeName(rawName);
                                    const dateValue = row[0] || '';
                                    const appointmentCount = row[3] || '';
                                    if (cleanName && dateValue && appointmentCount && allAllowedNames.includes(cleanName)) {
                                        const count = parseFloat(appointmentCount.toString().replace(/[^0-9.]/g, ''));
                                        if (!isNaN(count) && count > 0) {
                                            parsedAppointmentData.push({
                                                date: dateValue,
                                                name: cleanName,
                                                count: count,
                                                office: sheetName,
                                                source: `Appointment-${sheetName}`
                                            });
                                        }
                                    }
                                }
                            });
                        }
                    });

                    setData(parsedData);
                    const combinedInsPmt = [...parsedInsPmt, ...parsedCollectionData];
                    setInsPmtData(combinedInsPmt);
                    setProductionData(parsedProductionData);
                    setAppointmentData(parsedAppointmentData);

                    // Get unique names
                    const allNames = [
                        ...parsedData.map(row => row.name.trim().replace(/^["']|["']$/g, '')),
                        ...combinedInsPmt.map(row => row.name.trim().replace(/^["']|["']$/g, '')),
                        ...parsedProductionData.map(row => row.name.trim().replace(/^["']|["']$/g, '')),
                        ...parsedAppointmentData.map(row => row.name.trim().replace(/^["']|["']$/g, ''))
                    ];
                    const names = [...new Set(allNames)]
                        .filter(n => allAllowedNames.includes(n))
                        .sort();
                    
                    setUniqueNames(names);
                    setLastUpdated(new Date());
                    
                } catch (err) {
                    console.error('Error fetching data:', err);
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchDataFromSheet();
            }, []);

            // Calculate Performance Function - Part 1
            const calculatePerformance = () => {
                if (!selectedName) return null;

                let filtered = data.filter(row => {
                    let rowName = row.name.trim().replace(/^["']|["']$/g, '');
                    return rowName === selectedName;
                });
                
                let filteredInsPmt = insPmtData.filter(row => {
                    let rowName = row.name.trim().replace(/^["']|["']$/g, '');
                    return rowName === selectedName;
                });

                // Calculate number of working days
                let numberOfDays = 1;
                if (startDate && endDate) {
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    numberOfDays = Math.max(1, countWorkingDays(start, end));
                } else if (startDate || endDate) {
                    numberOfDays = 1;
                } else {
                    const uniqueDates = new Set();
                    filtered.forEach(row => {
                        const rowDate = parseDate(row.date);
                        if (rowDate) {
                            const shiftedDate = shiftWeekendToWeekday(rowDate);
                            if (shiftedDate) {
                                uniqueDates.add(shiftedDate.toDateString());
                            }
                        }
                    });
                    filteredInsPmt.forEach(row => {
                        const rowDate = parseDate(row.date);
                        if (rowDate) {
                            const shiftedDate = shiftWeekendToWeekday(rowDate);
                            if (shiftedDate) {
                                uniqueDates.add(shiftedDate.toDateString());
                            }
                        }
                    });
                    numberOfDays = Math.max(1, uniqueDates.size);
                }

                // Apply date filters
                if (startDate) {
                    const startDateObj = new Date(startDate);
                    startDateObj.setHours(0, 0, 0, 0);
                    filtered = filtered.filter(row => {
                        const rowDate = parseDate(row.date);
                        return rowDate && rowDate >= startDateObj;
                    });
                    filteredInsPmt = filteredInsPmt.filter(row => {
                        const rowDate = parseDate(row.date);
                        return rowDate && rowDate >= startDateObj;
                    });
                }
                
                if (endDate) {
                    const endDateObj = new Date(endDate);
                    endDateObj.setHours(23, 59, 59, 999);
                    filtered = filtered.filter(row => {
                        const rowDate = parseDate(row.date);
                        return rowDate && rowDate <= endDateObj;
                    });
                    filteredInsPmt = filteredInsPmt.filter(row => {
                        const rowDate = parseDate(row.date);
                        return rowDate && rowDate <= endDateObj;
                    });
                }

                const taskCounts = {};
                const unlistedTasks = {};
                let totalCollectionAmount = 0;
                let totalProductionAmount = 0;
                let totalTasks = 0;
                let totalCompletedAppointments = 0;
                let totalAppointments = 0;
                let totalCalls = 0;
                
                const userDepartment = getDepartment(selectedName);
                const userState = getEmployeeState(selectedName);

                // Process Data sheet entries
                filtered.forEach(row => {
                    const taskName = row.task.trim();
                    const taskLower = taskName.toLowerCase();
                    const standardTaskName = findTaskName(taskName);
                    
                    // Count tasks based on column E (amount) value
                    if (row.amount && row.amount.toString().trim()) {
                        const amountValue = parseFloat(row.amount.toString().replace(/[$,\s]/g, '').trim());
                        if (!isNaN(amountValue) && amountValue > 0) {
                            if (standardTaskName) {
                                taskCounts[standardTaskName] = (taskCounts[standardTaskName] || 0) + amountValue;
                                totalTasks += amountValue;
                            } else {
                                unlistedTasks[taskName] = (unlistedTasks[taskName] || 0) + amountValue;
                                totalTasks += amountValue;
                            }
                        }
                    }
                    
                    // Count appointments for Outbound Department
                    if (userDepartment === 'Outbound Department') {
                        if (standardTaskName === 'Inbound Appt' || standardTaskName === 'Outbound Appt') {
                            const amountValue = parseFloat((row.amount || '1').toString().replace(/[$,\s]/g, '').trim());
                            if (!isNaN(amountValue) && amountValue > 0) {
                                totalAppointments += amountValue;
                            }
                        }
                        
                        if (standardTaskName === 'Inbound Call' || standardTaskName === 'Outbound Call') {
                            const amountValue = parseFloat((row.amount || '1').toString().replace(/[$,\s]/g, '').trim());
                            if (!isNaN(amountValue) && amountValue > 0) {
                                totalCalls += amountValue;
                            }
                        }
                    }
                    
                    // Collection amounts for AR Department
                    if (userDepartment === 'AR Department' && taskLower === 'total balance collected') {
                        if (row.collectionAmount && row.collectionAmount.toString().trim()) {
                            const cleanAmount = row.collectionAmount.toString().replace(/[$,\s]/g, '').trim();
                            const amount = parseFloat(cleanAmount);
                            if (!isNaN(amount) && amount > 0) {
                                totalCollectionAmount += amount;
                            }
                        }
                    }
                });

                // Process production data (Outbound Department only)
                if (userDepartment === 'Outbound Department') {
                    let filteredProduction = productionData.filter(row => {
                        let rowName = row.name.trim().replace(/^["']|["']$/g, '');
                        return rowName === selectedName;
                    });
                    
                    if (startDate) {
                        const startDateObj = new Date(startDate);
                        startDateObj.setHours(0, 0, 0, 0);
                        filteredProduction = filteredProduction.filter(row => {
                            const rowDate = parseDate(row.date);
                            return rowDate && rowDate >= startDateObj;
                        });
                    }
                    
                    if (endDate) {
                        const endDateObj = new Date(endDate);
                        endDateObj.setHours(23, 59, 59, 999);
                        filteredProduction = filteredProduction.filter(row => {
                            const rowDate = parseDate(row.date);
                            return rowDate && rowDate <= endDateObj;
                        });
                    }
                    
                    filteredProduction.forEach(row => {
                        if (row.amount && row.amount.toString().trim()) {
                            const cleanAmount = row.amount.toString().replace(/[$,\s]/g, '').trim();
                            const amount = parseFloat(cleanAmount);
                            if (!isNaN(amount) && amount > 0) {
                                totalProductionAmount += amount;
                            }
                        }
                    });
                }

                // Calculate completed appointments (Outbound Department only)
                if (userDepartment === 'Outbound Department') {
                    let filteredAppointments = appointmentData.filter(row => {
                        let rowName = row.name.trim().replace(/^["']|["']$/g, '');
                        return rowName === selectedName;
                    });
                    
                    if (startDate) {
                        const startDateObj = new Date(startDate);
                        startDateObj.setHours(0, 0, 0, 0);
                        filteredAppointments = filteredAppointments.filter(row => {
                            const rowDate = parseDate(row.date);
                            return rowDate && rowDate >= startDateObj;
                        });
                    }
                    
                    if (endDate) {
                        const endDateObj = new Date(endDate);
                        endDateObj.setHours(23, 59, 59, 999);
                        filteredAppointments = filteredAppointments.filter(row => {
                            const rowDate = parseDate(row.date);
                            return rowDate && rowDate <= endDateObj;
                        });
                    }
                    
                    totalCompletedAppointments = filteredAppointments.reduce((sum, row) => sum + (row.count || 0), 0);
                }

                // Process Ins Pmt sheet for collection amounts (AR Department only)
                if (userDepartment === 'AR Department') {
                    filteredInsPmt.forEach(row => {
                        if (row.amount && row.amount.toString().trim()) {
                            const cleanAmount = row.amount.toString().replace(/[$,\s]/g, '').trim();
                            const amount = parseFloat(cleanAmount);
                            if (!isNaN(amount) && amount > 0) {
                                totalCollectionAmount += amount;
                            }
                        }
                    });
                }

                // Calculate state totals for percentage calculations
                let stateCollectionTotal = 0;
                let stateProductionTotal = 0;
                let stateAppointmentTotal = 0;
                let stateVerificationTotal = 0;
                const stateTaskTotals = {};

                // Get all employees in the same state
                const employeesInState = allAllowedNames.filter(name => getEmployeeState(name) === userState);

                // Calculate state totals
                employeesInState.forEach(empName => {
                    // Filter data for this employee
                    let empFiltered = data.filter(row => {
                        let rowName = row.name.trim().replace(/^["']|["']$/g, '');
                        return rowName === empName;
                    });
                    
                    let empFilteredInsPmt = insPmtData.filter(row => {
                        let rowName = row.name.trim().replace(/^["']|["']$/g, '');
                        return rowName === empName;
                    });

                    // Apply date filters
                    if (startDate) {
                        const startDateObj = new Date(startDate);
                        startDateObj.setHours(0, 0, 0, 0);
                        empFiltered = empFiltered.filter(row => {
                            const rowDate = parseDate(row.date);
                            return rowDate && rowDate >= startDateObj;
                        });
                        empFilteredInsPmt = empFilteredInsPmt.filter(row => {
                            const rowDate = parseDate(row.date);
                            return rowDate && rowDate >= startDateObj;
                        });
                    }
                    
                    if (endDate) {
                        const endDateObj = new Date(endDate);
                        endDateObj.setHours(23, 59, 59, 999);
                        empFiltered = empFiltered.filter(row => {
                            const rowDate = parseDate(row.date);
                            return rowDate && rowDate <= endDateObj;
                        });
                        empFilteredInsPmt = empFilteredInsPmt.filter(row => {
                            const rowDate = parseDate(row.date);
                            return rowDate && rowDate <= endDateObj;
                        });
                    }

                    const empDept = getDepartment(empName);

                    // AR Department - Collection
                    if (empDept === 'AR Department') {
                        empFiltered.forEach(row => {
                            const taskLower = row.task.trim().toLowerCase();
                            if (taskLower === 'total balance collected') {
                                if (row.collectionAmount && row.collectionAmount.toString().trim()) {
                                    const cleanAmount = row.collectionAmount.toString().replace(/[$,\s]/g, '').trim();
                                    const amount = parseFloat(cleanAmount);
                                    if (!isNaN(amount) && amount > 0) {
                                        stateCollectionTotal += amount;
                                    }
                                }
                            }
                        });

                        empFilteredInsPmt.forEach(row => {
                            if (row.amount && row.amount.toString().trim()) {
                                const cleanAmount = row.amount.toString().replace(/[$,\s]/g, '').trim();
                                const amount = parseFloat(cleanAmount);
                                if (!isNaN(amount) && amount > 0) {
                                    stateCollectionTotal += amount;
                                }
                            }
                        });
                    }

                    // Outbound Department - Production and Appointments
                    if (empDept === 'Outbound Department') {
                        let empFilteredProduction = productionData.filter(row => {
                            let rowName = row.name.trim().replace(/^["']|["']$/g, '');
                            return rowName === empName;
                        });

                        if (startDate) {
                            const startDateObj = new Date(startDate);
                            startDateObj.setHours(0, 0, 0, 0);
                            empFilteredProduction = empFilteredProduction.filter(row => {
                                const rowDate = parseDate(row.date);
                                return rowDate && rowDate >= startDateObj;
                            });
                        }
                        
                        if (endDate) {
                            const endDateObj = new Date(endDate);
                            endDateObj.setHours(23, 59, 59, 999);
                            empFilteredProduction = empFilteredProduction.filter(row => {
                                const rowDate = parseDate(row.date);
                                return rowDate && rowDate <= endDateObj;
                            });
                        }

                        empFilteredProduction.forEach(row => {
                            if (row.amount && row.amount.toString().trim()) {
                                const cleanAmount = row.amount.toString().replace(/[$,\s]/g, '').trim();
                                const amount = parseFloat(cleanAmount);
                                if (!isNaN(amount) && amount > 0) {
                                    stateProductionTotal += amount;
                                }
                            }
                        });

                        // Appointments
                        let empFilteredAppointments = appointmentData.filter(row => {
                            let rowName = row.name.trim().replace(/^["']|["']$/g, '');
                            return rowName === empName;
                        });

                        if (startDate) {
                            const startDateObj = new Date(startDate);
                            startDateObj.setHours(0, 0, 0, 0);
                            empFilteredAppointments = empFilteredAppointments.filter(row => {
                                const rowDate = parseDate(row.date);
                                return rowDate && rowDate >= startDateObj;
                            });
                        }
                        
                        if (endDate) {
                            const endDateObj = new Date(endDate);
                            endDateObj.setHours(23, 59, 59, 999);
                            empFilteredAppointments = empFilteredAppointments.filter(row => {
                                const rowDate = parseDate(row.date);
                                return rowDate && rowDate <= endDateObj;
                            });
                        }

                        stateAppointmentTotal += empFilteredAppointments.reduce((sum, row) => sum + (row.count || 0), 0);
                    }

                    // Verification Department
                    if (empDept === 'Verification Department') {
                        empFiltered.forEach(row => {
                            const standardTaskName = findTaskName(row.task.trim());
                            if (standardTaskName === 'Verification') {
                                if (row.amount && row.amount.toString().trim()) {
                                    const amountValue = parseFloat(row.amount.toString().replace(/[$,\s]/g, '').trim());
                                    if (!isNaN(amountValue) && amountValue > 0) {
                                        stateVerificationTotal += amountValue;
                                    }
                                }
                            }
                        });
                    }

                    // Task totals for state
                    empFiltered.forEach(row => {
                        const standardTaskName = findTaskName(row.task.trim());
                        if (standardTaskName && row.amount && row.amount.toString().trim()) {
                            const amountValue = parseFloat(row.amount.toString().replace(/[$,\s]/g, '').trim());
                            if (!isNaN(amountValue) && amountValue > 0) {
                                stateTaskTotals[standardTaskName] = (stateTaskTotals[standardTaskName] || 0) + amountValue;
                            }
                        }
                    });
                });

                // Calculate percentages
                const collectionPercentage = stateCollectionTotal > 0 ? (totalCollectionAmount / stateCollectionTotal) * 100 : 0;
                const productionPercentage = stateProductionTotal > 0 ? (totalProductionAmount / stateProductionTotal) * 100 : 0;
                const appointmentPercentage = stateAppointmentTotal > 0 ? (totalCompletedAppointments / stateAppointmentTotal) * 100 : 0;
                const verificationPercentage = stateVerificationTotal > 0 ? ((taskCounts['Verification'] || 0) / stateVerificationTotal) * 100 : 0;

                // Calculate task percentages
                const taskPercentages = {};
                Object.keys(taskCounts).forEach(taskName => {
                    const stateTotal = stateTaskTotals[taskName] || 0;
                    taskPercentages[taskName] = stateTotal > 0 ? (taskCounts[taskName] / stateTotal) * 100 : 0;
                });

                const sortedTasks = Object.entries(taskCounts).sort((a, b) => b[1] - a[1]);
                const sortedUnlistedTasks = Object.entries(unlistedTasks).sort((a, b) => b[1] - a[1]);

                // Calculate overall performance
                let overallPerformance = 0;
                
                if (userDepartment === 'Outbound Department') {
                    const appointmentGoal = 20 * numberOfDays;
                    const callGoal = 100 * numberOfDays;
                    const productionGoal = getEmployeeGoal(selectedName, 'production') * numberOfDays;
                    
                    const appointmentPerf = appointmentGoal > 0 ? (totalAppointments / appointmentGoal) * 100 : 0;
                    const callPerf = callGoal > 0 ? (totalCalls / callGoal) * 100 : 0;
                    const productionPerf = productionGoal > 0 ? (totalProductionAmount / productionGoal) * 100 : 0;
                    
                    overallPerformance = Math.min(100, ((appointmentPerf + callPerf + productionPerf) / 3));
                } else if (userDepartment === 'AR Department') {
                    const collectionGoal = getEmployeeGoal(selectedName, 'collection') * numberOfDays;
                    const collectionPerf = collectionGoal > 0 ? (totalCollectionAmount / collectionGoal) * 100 : 0;
                    overallPerformance = Math.min(100, collectionPerf);
                } else if (userDepartment === 'Verification Department') {
                    const verificationGoal = getEmployeeGoal(selectedName, 'verification') * numberOfDays;
                    const verificationCount = taskCounts['Verification'] || 0;
                    const verificationPerf = verificationGoal > 0 ? (verificationCount / verificationGoal) * 100 : 0;
                    overallPerformance = Math.min(100, verificationPerf);
                }

                return {
                    taskCounts: sortedTasks,
                    unlistedTasks: sortedUnlistedTasks,
                    taskPercentages,
                    totalCollectionAmount: totalCollectionAmount.toFixed(2),
                    totalProductionAmount: totalProductionAmount.toFixed(2),
                    collectionPercentage: collectionPercentage.toFixed(1),
                    productionPercentage: productionPercentage.toFixed(1),
                    appointmentPercentage: appointmentPercentage.toFixed(1),
                    verificationPercentage: verificationPercentage.toFixed(1),
                    overallPerformance: Math.round(overallPerformance),
                    totalTasks: Math.round(totalTasks),
                    department: userDepartment,
                    state: userState,
                    totalAppointments: totalAppointments,
                    totalCalls: totalCalls,
                    totalCompletedAppointments: totalCompletedAppointments,
                    numberOfDays: numberOfDays,
                    appointmentGoal: userDepartment === 'Outbound Department' ? 20 * numberOfDays : null,
                    callGoal: userDepartment === 'Outbound Department' ? 100 * numberOfDays : null,
                    collectionGoal: userDepartment === 'AR Department' ? getEmployeeGoal(selectedName, 'collection') * numberOfDays : null,
                    productionGoal: userDepartment === 'Outbound Department' ? getEmployeeGoal(selectedName, 'production') * numberOfDays : null,
                    verificationCount: taskCounts['Verification'] || 0,
                    verificationGoal: userDepartment === 'Verification Department' ? getEmployeeGoal(selectedName, 'verification') * numberOfDays : null
                };
            };

            const performance = calculatePerformance();

            // Render
            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-8">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="flex items-center justify-between mb-8">
                            <div className="flex items-center gap-3">
                                <div className="bg-blue-600 p-3 rounded-xl">
                                    <Calculator />
                                </div>
                                <h1 className="text-3xl font-bold text-white">KPI Dashboard</h1>
                            </div>

                            <div className="flex items-center gap-4">
                                {/* Date Range */}
                                <div className="flex items-center gap-2 bg-slate-800 px-4 py-2 rounded-xl border border-slate-700">
                                    <Calendar />
                                    <input
                                        type="date"
                                        value={startDate}
                                        onChange={(e) => setStartDate(e.target.value)}
                                        className="bg-transparent text-white text-sm focus:outline-none"
                                    />
                                    <span className="text-slate-400">-</span>
                                    <input
                                        type="date"
                                        value={endDate}
                                        onChange={(e) => setEndDate(e.target.value)}
                                        className="bg-transparent text-white text-sm focus:outline-none"
                                    />
                                </div>

                                {/* All Users Dropdown */}
                                <div className="flex items-center gap-2 bg-slate-800 px-4 py-2 rounded-xl border border-slate-700">
                                    <User />
                                    <select
                                        value={selectedName}
                                        onChange={(e) => setSelectedName(e.target.value)}
                                        className="bg-transparent text-white text-sm focus:outline-none cursor-pointer"
                                    >
                                        <option value="">All Users</option>
                                        {uniqueNames.map(name => (
                                            <option key={name} value={name}>{name}</option>
                                        ))}
                                    </select>
                                </div>

                                {/* Refresh Button */}
                                <button
                                    onClick={fetchDataFromSheet}
                                    disabled={loading}
                                    className="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded-xl transition-colors"
                                >
                                    <RefreshCw />
                                    <span className="text-sm font-semibold">{loading ? 'Refreshing...' : 'Refresh'}</span>
                                </button>
                            </div>
                        </div>

                        {error && (
                            <div className="mb-6 p-4 bg-red-900/50 border border-red-700 rounded-xl text-red-200 text-sm">
                                {error}
                            </div>
                        )}

                        {performance && selectedName && (
                            <div className="space-y-6">
                                {/* KPI Cards */}
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    {/* Card 1 - Total Collection/Production/Verification */}
                                    <div className="bg-slate-800 rounded-2xl p-6 border border-slate-700 relative overflow-hidden group hover:border-blue-500 transition-all">
                                        <div className="absolute top-0 right-0 w-24 h-24 bg-blue-500/10 rounded-full -mr-12 -mt-12 group-hover:scale-150 transition-transform"></div>
                                        <div className="relative">
                                            <div className="flex items-center gap-3 mb-4">
                                                <div className="bg-blue-600/20 p-2 rounded-lg">
                                                    <DollarSign />
                                                </div>
                                                <h3 className="text-slate-400 text-sm font-medium">
                                                    {performance.department === 'AR Department' ? 'Total Collection' :
                                                     performance.department === 'Outbound Department' ? 'Total Production' :
                                                     'Total Verifications'}
                                                </h3>
                                            </div>
                                            <p className="text-white text-3xl font-bold mb-2">
                                                {performance.department === 'AR Department' ? `${parseFloat(performance.totalCollectionAmount).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}` :
                                                 performance.department === 'Outbound Department' ? `${parseFloat(performance.totalProductionAmount).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}` :
                                                 performance.verificationCount}
                                            </p>
                                            <div className="flex items-center gap-2">
                                                <TrendingUp />
                                                <span className="text-green-400 text-sm font-semibold">
                                                    {performance.department === 'AR Department' ? `${performance.collectionPercentage}%` :
                                                     performance.department === 'Outbound Department' ? `${performance.productionPercentage}%` :
                                                     `${performance.verificationPercentage}%`} of state total
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Card 2 - Goal */}
                                    <div className="bg-slate-800 rounded-2xl p-6 border border-slate-700 relative overflow-hidden group hover:border-purple-500 transition-all">
                                        <div className="absolute top-0 right-0 w-24 h-24 bg-purple-500/10 rounded-full -mr-12 -mt-12 group-hover:scale-150 transition-transform"></div>
                                        <div className="relative">
                                            <div className="flex items-center gap-3 mb-4">
                                                <div className="bg-purple-600/20 p-2 rounded-lg">
                                                    <Clipboard />
                                                </div>
                                                <h3 className="text-slate-400 text-sm font-medium">
                                                    {performance.department === 'AR Department' ? 'Collection Goal' :
                                                     performance.department === 'Outbound Department' ? 'Production Goal' :
                                                     'Verification Goal'}
                                                </h3>
                                            </div>
                                            <p className="text-white text-3xl font-bold mb-2">
                                                {performance.department === 'AR Department' && performance.collectionGoal ? `${performance.collectionGoal.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}` :
                                                 performance.department === 'Outbound Department' && performance.productionGoal ? `${performance.productionGoal.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}` :
                                                 performance.verificationGoal || 0}
                                            </p>
                                            <p className="text-slate-400 text-sm">
                                                {performance.numberOfDays} working {performance.numberOfDays === 1 ? 'day' : 'days'}
                                            </p>
                                        </div>
                                    </div>

                                    {/* Card 3 - Completed Appointments (Outbound only) */}
                                    {performance.department === 'Outbound Department' && (
                                        <div className="bg-slate-800 rounded-2xl p-6 border border-slate-700 relative overflow-hidden group hover:border-yellow-500 transition-all">
                                            <div className="absolute top-0 right-0 w-24 h-24 bg-yellow-500/10 rounded-full -mr-12 -mt-12 group-hover:scale-150 transition-transform"></div>
                                            <div className="relative">
                                                <div className="flex items-center gap-3 mb-4">
                                                    <div className="bg-yellow-600/20 p-2 rounded-lg">
                                                        <CheckCircle />
                                                    </div>
                                                    <h3 className="text-slate-400 text-sm font-medium">Completed Appointments</h3>
                                                </div>
                                                <p className="text-white text-3xl font-bold mb-2">
                                                    {performance.totalCompletedAppointments || 0}
                                                </p>
                                                <div className="flex items-center gap-2">
                                                    <TrendingUp />
                                                    <span className="text-green-400 text-sm font-semibold">
                                                        {performance.appointmentPercentage}% of state total
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* Card 4 - Overall Performance */}
                                    <div className="bg-slate-800 rounded-2xl p-6 border border-slate-700 relative overflow-hidden group hover:border-green-500 transition-all">
                                        <div className="absolute top-0 right-0 w-24 h-24 bg-green-500/10 rounded-full -mr-12 -mt-12 group-hover:scale-150 transition-transform"></div>
                                        <div className="relative">
                                            <div className="flex items-center gap-3 mb-4">
                                                <div className="bg-green-600/20 p-2 rounded-lg">
                                                    <Clock />
                                                </div>
                                                <h3 className="text-slate-400 text-sm font-medium">Overall Performance</h3>
                                            </div>
                                            <p className="text-white text-3xl font-bold mb-2">
                                                {performance.overallPerformance}%
                                            </p>
                                            <p className="text-slate-400 text-sm">
                                                Based on department metrics
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {/* Task Distribution Chart - Placeholder */}
                                <div className="bg-slate-800 rounded-2xl p-6 border border-slate-700">
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="bg-blue-600/20 p-2 rounded-lg">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                <line x1="18" y1="20" x2="18" y2="10"/>
                                                <line x1="12" y1="20" x2="12" y2="4"/>
                                                <line x1="6" y1="20" x2="6" y2="14"/>
                                            </svg>
                                        </div>
                                        <h3 className="text-xl font-bold text-white">Task Distribution</h3>
                                    </div>
                                    <div className="text-center py-12 text-slate-400">
                                        <p>Chart visualization coming soon</p>
                                    </div>
                                </div>

                                {/* Top Tasks Section */}
                                <div className="bg-slate-800 rounded-2xl p-6 border border-slate-700">
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="bg-purple-600/20 p-2 rounded-lg">
                                            <Clipboard />
                                        </div>
                                        <h3 className="text-xl font-bold text-white">Top Tasks</h3>
                                    </div>

                                    <div className="space-y-3">
                                        {performance.taskCounts.map(([taskName, count], index) => (
                                            <div key={taskName} className="bg-slate-700/50 rounded-xl p-4 hover:bg-slate-700 transition-all">
                                                <div className="flex items-center justify-between">
                                                    <div className="flex-1">
                                                        <h4 className="text-white font-semibold mb-1">{taskName}</h4>
                                                        <p className="text-slate-400 text-sm">{Math.round(count)} tasks</p>
                                                    </div>
                                                    <div className="text-right">
                                                        <p className="text-2xl font-bold text-white">
                                                            ${(count * 100).toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}
                                                        </p>
                                                        <div className="flex items-center gap-1 justify-end mt-1">
                                                            <span className="text-green-400 text-sm font-semibold">
                                                                +{performance.taskPercentages[taskName]?.toFixed(1) || 0}% of state total
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}

                                        {performance.unlistedTasks.length > 0 && (
                                            <>
                                                <div className="pt-4 pb-2">
                                                    <h4 className="text-yellow-400 font-semibold text-sm">Other Tasks</h4>
                                                </div>
                                                {performance.unlistedTasks.map(([taskName, count]) => (
                                                    <div key={taskName} className="bg-yellow-900/20 rounded-xl p-4 hover:bg-yellow-900/30 transition-all border border-yellow-700/30">
                                                        <div className="flex items-center justify-between">
                                                            <div className="flex-1">
                                                                <h4 className="text-yellow-200 font-semibold mb-1">{taskName}</h4>
                                                                <p className="text-yellow-400/70 text-sm">{Math.round(count)} tasks</p>
                                                            </div>
                                                            <div className="text-right">
                                                                <p className="text-xl font-bold text-yellow-300">
                                                                    ${(count * 100).toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </>
                                        )}

                                        {performance.taskCounts.length === 0 && performance.unlistedTasks.length === 0 && (
                                            <div className="text-center py-8 text-slate-400">
                                                <p>No tasks found for the selected filters</p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {!selectedName && (
                            <div className="text-center py-20">
                                <div className="bg-slate-800 rounded-2xl p-12 border border-slate-700 inline-block">
                                    <User />
                                    <p className="text-slate-400 mt-4">Select an employee to view performance data</p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<PerformanceTracker />, document.getElementById('root'));
    </script>
</body>
</html>
